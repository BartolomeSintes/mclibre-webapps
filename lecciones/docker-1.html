<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Ejercicios (1). Docker. Aplicaciones web. Bartolomé Sintes Marco. www.mclibre.org</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../varios/webapps.css" title="mclibre" />
  <link rel="icon" href="../varios/favicon.ico" />
</head>

<body>
  <h1>Docker - Ejercicios (1) - Enunciados</h1>

  <nav>
    <p>
      <a href="../index.html"><img src="../varios/iconos/icono-webapps.svg" alt="Índice de WebApps" title="Índice de WebApps" width="48" height="31" /></a>
      <a href="#"><img src="../varios/iconos/icono-arrow-circle-up.svg" alt="Principio de la página" title="Principio de la página" width="36" height="36" /></a>
    </p>

    <div class="toc">
      <h2>
        <a href="docker.html"><img src="../varios/iconos/icono-flecha-izquierda.svg" alt="Anterior" title="Anterior" width="15" height="18" /></a> Docker (1)
      </h2>

      <h3><a href="#">Enunciados</a></h3>
      <ul>
        <li><a href="#ejercicio-1">1 - Instalar Docker</a></li>
        <li><a href="#ejercicio-2">2 - Instalar OpenCart</a></li>
        <li><a href="#ejercicio-3">3 - Probar comandos</a></li>
        <li><a href="#ejercicio-4">4 - Instalar phpMyAdmin</a></li>
        <li><a href="#ejercicio-5">5 - Instalar 2 aplicaciones</a></li>
      </ul>

      <h3><a href="docker-1-soluciones.html">Soluciones</a></h3>
      <ul>
        <li><a href="docker-1-soluciones.html#ejercicio-4">4 - Instalar phpMyAdmin</a></li>
        <li><a href="docker-1-soluciones.html#ejercicio-5">5 - Instalar 2 aplicaciones</a></li>
      </ul>
    </div>
  </nav>

  <p>Esta lección es una introducción a la instalación de aplicaciones mediante <strong>Docker</strong>, utilizando las imágenes proporcionadas por Bitnami. Como es la primera vez que trato en clase el uso de Docker, esta lección tiene un carácter "experimental". Los dos primeros ejercicios están planteados como actividades guiadas, por lo que no se ofrece una página de soluciones. Se pueden consultar las <a href="bitnami-3-soluciones.html">soluciones de los demás ejercicios de Docker (1)</a>, aunque se recomienda intentar realizarlos primero sin recurrir a estas soluciones.</p>

  <section id="ejercicio-1">
    <h2>Docker (1) 1 - Instalar Docker</h2>

    <p>En este ejercicio instalaremos Docker en una máquina virtual de Ubuntu 16.04.3 LTS Server ejecutada en VirtualBox.</p>

    <p>Estas instrucciones se han extraido de la documentación oficial de Docker <a href="https://docs.docker.com/engine/installation/linux/ubuntulinux/">Install Docker on Ubuntu</a></p>

    <h3>Prepare la máquina virtual</h3>

    <ol>
      <li>Descargue la imagen iso de la versión más reciente de <strong>Ubuntu 16.04 LTS Server de 64 bits</strong>.
        <p>Actualmente (enero de 2018), la última versión disponible de Ubuntu LTS Server es Ubuntu 16.04.3 (03/08/17). <a href="http://releases.ubuntu.com/16.04/">Página de descarga</a></p>
      </li>
      <li>Cree una máquina virtual en VirtualBox e instale Ubuntu 16.04 LTS Server.
        <p>Para los ejercicios de esta página un disco duro virtual de 8 GB es suficiente, pero para poder instalar más aplicaciones se necesitaría un disco mayor, por ejemplo de <strong>16 GB</strong>.</p>
        <p>Compruebe que en la configuración de red de la máquina virtual está conectado a <strong>Adaptador puente</strong>. Si está conectado a otro tipo de adaptador (probablemente NAT), apague la máquina virtual, cambie a Adaptador puente y reinicie la máquina virtual.</p>
      </li>
      <li>Actualice Ubuntu 16.04 LTS Server:
        <div class="codigo">
          <pre>
<code class="language-shell">sudo apt update
sudo apt upgrade</code>
</pre>
        </div>
      </li>
    </ol>

    <h3>Actualice los repositorios de APT</h3>

    <p>Arranque la máquina virtual y ejecute los comandos siguientes en un terminal:</p>

    <ol>
      <li>Instale los certificados para trabajar con https:
        <div class="codigo">
          <pre>
<code class="language-shell">sudo apt update
sudo apt install apt-transport-https ca-certificates curl software-properties-common</code>
</pre>
        </div>
      </li>
      <li>Añada la clave GPG oficial de Docker:
        <div class="codigo">
          <pre>
<code class="language-shell">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</code>
</pre>
        </div>
      </li>
      <li>Compruebe que tiene la clave correcta:
        <div class="codigo">
          <pre>
<code class="language-shell">sudo apt-key fingerprint 0EBFCD88</code>
</pre>
        </div>
        <p>El resultado debe ser:</p>
        <div class="codigo">
          <pre>
<code class="language-shell">pub   4096R/0EBFCD88 2017-02-22
      Key fingerprint = 9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88
uid                  Docker Release (CE deb) &lt;docker@docker.com&gt;
sub   4096R/F273FCD8 2017-02-22</code>
</pre>
        </div>
      </li>
      <li>Añada el repositorio correspondiente a su versión de Ubuntu (escriba todo en una sola línea, sin las contrabarras \):
        <div class="codigo">
          <pre>
<code class="language-shell">sudo add-apt-repository \
   "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   $(lsb_release -cs) \
   stable"</code>
</pre>
        </div>
      </li>
      <li>Actualice APT:
        <div class="codigo">
          <pre><code class="language-shell">sudo apt update</code></pre>
        </div>
      </li>
      <li>Compruebe que APT se conecta con el repositorio adecuado:
        <div class="codigo">
          <pre><code class="language-shell">apt policy docker-ce</code></pre>
        </div>
        <p>En la pantalla debe mostrarse el repositorio de la versión de Ubuntu indicada (en el ejemplo se muestra xenial, es decir, Ubuntu 16.04):</p>
        <div class="codigo">
          <pre>
<code class="language-shell">docker-ce:
  Instalados: (ninguno)
  Candidato: 17.12.0~ce-0~ubuntu
  Tabla de versión:
  17.12.0~ce-0~ubuntu 500
          500 https://download.docker.com/linux/ubuntu xenial/stable amd64 Packages
    ...</code>
</pre>
        </div>
      </li>
    </ol>

    <h3>Instale Docker</h3>

    <p>En la máquina virtual, ejecute los comandos siguientes en un terminal:</p>

    <ol>
      <li>Actualice el administrador de paquetes:
        <div class="codigo">
          <pre><code class="language-shell">sudo apt update</code></pre>
        </div>
      </li>
      <li>Instale la última versión de Docker
        <div class="codigo">
          <pre><code class="language-shell">sudo apt install docker-ce</code></pre>
        </div>
      </li>
      <li>Arranque el servicio docker
        <div class="codigo">
          <pre><code class="language-shell">sudo service docker start</code></pre>
        </div>
      </li>
      <li>Compruebe que docker está instalado correctamente ejecutando la imagen hello-world:
        <div class="codigo">
          <pre><code class="language-shell">sudo docker run hello-world</code></pre>
        </div>
        <p>Se descargará e instalará la aplicación y se mostrará el mensaje:</p>
        <div class="codigo">
          <pre>
<code class="language-shell">Hello from Docker!
This message shows that your installation appears to be working correctly.
...</code>
</pre>
        </div>
      </li>
    </ol>
  </section>

  <section id="ejercicio-2">
    <h2>Docker (1) 2 - Instalar OpenCart</h2>

    <p>En este ejercicio instalaremos OpenCart en un contenedor Docker.</p>

    <p>Los repositorios de las imágenes de Bitnami son <a href="https://github.com/bitnami/bitnami-docker-mariadb">Bitnami MariaDB OpenCart</a>, <a href="https://github.com/bitnami/bitnami-docker-opencart">Bitnami Docker OpenCart</a>.</p>

    <ol>
      <li>Averigüe la dirección ip de la máquina virtual.</li>
      <li>Cree una nueva red para la aplicación y la base de datos:
        <div class="codigo">
          <pre><code class="language-shell">sudo docker network create opencart-network</code></pre>
        </div>
      </li>
      <li>Cree un contenedor con la base de datos MariaDB en la nueva red:
        <div class="codigo">
          <pre><code class="language-shell">sudo docker run -d --name=mariadb -e ALLOW_EMPTY_PASSWORD=yes --net=opencart-network bitnami/mariadb</code></pre>
        </div>
        <p><strong>Nota</strong>: El nombre mariadb se puede cambiar, pero tenga en cuenta que las imágenes de bitnami suponen de forma predeterminada que ese es el nombre del contenedor de la base de datos. Si utiliza otro nombre de contenedor, deberá añadir la opción de configuración correspondiente al crear el contenedor de la aplicación.</p>
        <p><strong>Nota</strong>: Algunas de las variables disponibles (y su valores predeterminados entre corchetes) son MARIADB_EXTRA_FLAGS, MARIADB_ROOT_USER [root], MARIADB_ROOT_PASSWORD [], ALLOW_EMPTY_PASSWORD, MARIADB_USER, MARIADB_PASSWORD, MARIADB_DATABASE.</p>
      </li>
      <li>Cree un contenedor con OpenCart en la misma red (sustituya AAA.BBB.CCC.DDD por la dirección ip de la máquina virtual):
        <div class="codigo">
          <pre><code class="language-shell">sudo docker run -d --name=opencart -e OPENCART_HOST=AAA.BBB.CCC.DDD -p 80:80 -p 443:443 --net=opencart-network bitnami/opencart</code></pre>
        </div>
        <p><strong>Nota</strong>: Las variables disponibles (y su valores predeterminados entre corchetes) son OPENCART_USERNAME [user], OPENCART_PASSWORD [bitnami1], OPENCART_EMAIL [user@example.com], OPENCART_HOST, MARIADB_PASSWORD, MARIADB_HOST [mariadb], MARIADB_PORT_NUMBER [3306].</p>
      </li>
      <li>Compruebe que puede acceder a OpenCart en el navegador escribiendo la dirección <strong>http://AAA.BBB.CCC.DDD</strong>, donde AAA.BBB.CCC.DDD es la dirección ip de la máquina virtual:
        <p class="captura"><img src="../img/bitnami/3-2-e-1-opencart.jpg" alt="Tienda OpenCart" width="495" height="275" /></p>
      </li>
      <li>Compruebe que puede acceder como administrador a OpenCart en el navegador escribiendo la dirección <strong>http://AAA.BBB.CCC.DDD/admin</strong>, donde AAA.BBB.CCC.DDD es la dirección ip de la máquina virtual.
        <p>El usuario administrador predeterminado de OpenCart es <strong>user</strong> con contraseña <strong>bitnami1</strong>:</p>
        <p class="captura"><img src="../img/bitnami/3-2-e-2-opencart.png" alt="Administración de OpenCart" width="495" height="275" /></p>
      </li>
    </ol>
  </section>

  <section id="ejercicio-3">
    <h2>Docker (1) 3 - Probar los comandos de Docker</h2>

    <p>En este ejercicio se trabaja con el OpenCart instalado en el ejercicio anterior.</p>

    <p>Puede consultar la <a href="https://github.com/wsargent/docker-cheat-sheet">Docker Cheat Sheet</a> para obtener información sobre los comandos básicos de Docker.</p>

    <h3>Detener y poner en marcha</h3>
    <ol>
      <li>Modifique la tienda OpenCart eliminando alguna categoría del menú principal.</li>
      <li>Detenga y reinice el contenedor y compruebe que la tienda conserva los cambios. Los comandos que se deben utilizar son:
        <p>Para ver los contenedores existentes (en marcha o detenidos):</p>
        <div class="codigo">
          <pre><code class="language-shell">sudo docker ps -a</code></pre>
        </div>
        <p>Para detener un contenedor:</p>
        <div class="codigo">
          <pre><code class="language-shell">sudo docker stop CONTENEDOR</code></pre>
        </div>
        <p>Para poner en marcha un contenedor detenido:</p>
        <div class="codigo">
          <pre><code class="language-shell">sudo docker start CONTENEDOR</code></pre>
        </div>
      </li>
      <li>Detenga y borre el contenedor. Cree un nuevo contendor y compruebe que los cambios se han perdido. Los comandos que se deben utilizar son:
        <p>Para borrar un contenedor (debe estar detenido primero):</p>
        <div class="codigo">
          <pre><code class="language-shell">sudo docker rm CONTENEDOR</code></pre>
        </div>
        <p><strong>Nota</strong>: La base de datos no se ha borrado, así que se podría cambiar el usuario y contraseña de la tienda para usar la antigua base de datos y recuperar la tienda antigua.</p>
      </li>
    </ol>

    <h3>Cambio de IP</h3>

    <p>Si cambiara la IP de la máquina virtual, OpenCart dejaría de funcionar correctamente porque en los archivos de configuración de OpenCart se guarda la URL de OpenCart. En clase esto ocurre de vez en cuando, ya que el router de aula está continuamente asignando direcciones.</p>

    <ol>
      <li>Apague y reinicie la máquina virtual.
        <ul>
          <li>Si cambia la IP de la máquina virtual, compruebe que la tienda OpenCart ya no se ve correctamente</li>
          <li>Si <strong>no</strong> cambia la IP de la máquina virtual, haga el ejercicio sin cambiar la IP, pero así sabrá cómo hacerlo si algún día cambia la IP.</li>
        </ul>
      </li>
      <li>Corrija los archivos de configuración de OpenCart con la nueva IP.
        <p>La forma más fácil es copiar los dos archivos de configuración de OpenCart del contenedor a la máquina virtual, modificarlos y volverlos a copiar a la imagen</p>
        <div class="codigo">
          <pre><code class="language-shell">sudo docker cp CONTENEDOR:ORIGEN DESTINO</code></pre>
        </div>

        <p>Para averiguar el directorio del sistema de ficheros del contenedor en el que se encuentra opencart, puede abrir una sesión en la imagen y después buscarlo:</p>
        <div class="codigo">
          <pre><code class="language-shell">sudo docker exec -it CONTENEDOR /bin/bash</code></pre>
        </div>
        <details>
          <summary><strong>Ayuda</strong></summary>
          <p>Los ficheros de configuración están en /bitnami/opencart/config.php y /bitnami/opencart/admin/config.php. Los ficheros se pueden copiar en cualquier carpeta fuera del contenedor. Por ejemplo,</p>
          <div class="codigo">
            <pre><code class="language-shell">sudo docker cp opencart:/bitnami/opencart/config.php /tmp/config.php</code></pre>
          </div>
        </details>
      </li>
      <li>Compruebe que la tienda OpenCart vuelve a verse correctamente.</li>
    </ol>
  </section>

  <section id="ejercicio-4">
    <h2>Docker (1) 4 - Instalar phpMyAdmin</h2>

    <p>En este ejercicio se pide instalar phpMyAdmin en un contenedor Docker.</p>

    <p>El repositorio de las imágenes de Bitnami es <a href="https://github.com/bitnami/bitnami-docker-phpmyadmin">Bitnami phpMyAdmin OpenCart</a>.</p>

    <ol>
      <li>Cree un contenedor de phpMyadmin, al que se pueda acceder a través del puerto 8801.</li>
      <li>Compruebe que puede ver la página inicial de conexión de phpMyAdmin en el navegador escribiendo la dirección <strong>http://AAA.BBB.CCC.DDD:8801</strong>, donde AAA.BBB.CCC.DDD es la dirección ip de la máquina virtual.</li>
      <li>Averigüe la contraseña del usuario de OpenCart y entre con phpMyAdmin para ver la base de datos</li>
    </ol>
  </section>

  <section id="ejercicio-5">
    <h2>Docker (1) 5 - Instalar dos aplicaciones (OPTATIVO)</h2>

    <p>En este ejercicio se pide instalar la misma aplicación dos veces (por ejemplo, dos instalaciones de WordPress), pero que utilicen el mismo contenedor con la base de datos, con el objetivo de hacerlos accesibles mediante las URLs <strong>http://AAA.BBB.CCC.DDD:8802</strong> y <strong>http://AAA.BBB.CCC.DDD:8803</strong>.</p>

    <ol>
      <li>Cree una nueva red.</li>
      <li>Cree un contenedor de MariaDB.</li>
      <li>Cree un contenedor de phpMyAdmin al que se acceda por el puerto 8801.</li>
      <li>Compruebe que puede acceder a phpMyAdmin desde el host.</li>
      <li>Cree los usuarios wp1 y wp2, con base de datos única y con contraseña wp1 y wp2 y que puedan acceder desde cualquier nombre de host.</li>
      <li>Cree un primer contenedor de WordPress que escuche en los puertos 8802 y 4432.</li>
      <li>Compruebe que puede acceder a este WordPress desde el host.</li>
      <li>Modifique el título del WordPress.</li>
      <li>Cree un segundo contenedor de WordPress que escuche en los puertos 8803 y 4433.</li>
      <li>Compruebe que puede acceder a este WordPress desde el host.</li>
      <li>Modifique el tema o el título del WordPress para distinguirlo del anterior.</li>
    </ol>
  </section>

  <footer>
    <p class="ultmod">Última modificación de esta página: 8 de febrero de 2018</p>

    <p class="licencia">
      <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.es_ES"><img src="../varios/iconos/icono-cc-by-sa.svg" alt="Licencia Creative Commons" title="Licencia Creative Commons BY-SA" width="120" height="42" /></a><br />
      Esta página forma parte del curso <strong><a href="http://www.mclibre.org/consultar/webapps/">Aplicaciones web</a></strong> por <a href="http://www.mclibre.org/" rel="author">Bartolomé Sintes Marco</a><br />
      que se distribuye bajo una <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.es_ES">Licencia Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional (CC BY-SA 4.0)</a>.
    </p>
  </footer>
</body>
</html>
