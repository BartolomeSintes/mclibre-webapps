<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Ejercicios (1). Docker. Aplicaciones web. Bartolomé Sintes Marco. www.mclibre.org</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../varios/webapps.css" title="mclibre" />
  <link rel="icon" href="../varios/favicon.ico" />
  <link rel="stylesheet" href="../varios/prism-webapps.css" />
  <script src="../varios/prism.js"></script>
</head>

<body>
  <h1>Docker - Ejercicios (1) - Enunciados</h1>

  <nav>
    <p>
      <a href="../index.html"><img src="../varios/iconos/icono-webapps.svg" alt="Índice de WebApps" title="Índice de WebApps" width="48" height="31" /></a>
      <a href="#"><img src="../varios/iconos/icono-arrow-circle-up.svg" alt="Principio de la página" title="Principio de la página" width="36" height="36" /></a>
    </p>

    <div class="toc">
      <h2>
        <a href="docker.html"><img src="../varios/iconos/icono-flecha-izquierda.svg" alt="Anterior" title="Anterior" width="15" height="18" /></a> Docker (1)
        <a href="docker-2.html"><img src="../varios/iconos/icono-flecha-derecha.svg" alt="Siguiente" title="Siguiente" width="15" height="18" /></a>
      </h2>

      <h3><a href="#">Enunciados</a></h3>
      <ul>
        <li><a href="#ejercicio-1">1 - Instalar Docker</a></li>
        <li><a href="#ejercicio-2">2 - Imagen hello-world</a></li>
        <li><a href="#ejercicio-3">3 - Imagen Apache</a></li>
        <li><a href="#ejercicio-4">4 - Volúmenes</a></li>
      </ul>
    </div>
  </nav>

  <p class="incompleto"><img src="../varios/iconos/icono-en-construccion.svg" alt="En construcción" width="55" height="48" />Esta lección está por completar. Por ahora, están completos los ejercicios 1 y 2.</p>

  <p>Esta lección es una introducción a la instalación de aplicaciones mediante <strong>Docker</strong>, utilizando las imágenes proporcionadas por Bitnami. Esta lección tiene un carácter "experimental". Los ejercicios están planteados como actividades guiadas, por lo que no se ofrece una página de soluciones.</p>

  <section id="ejercicio-1">
    <h2>Docker (1) 1 - Instalar Docker</h2>

    <p>En este ejercicio instalaremos Docker en una máquina virtual de Ubuntu 18.04.1 LTS Server ejecutada en VirtualBox.</p>

    <p>Estas instrucciones se han extraido de la documentación oficial de Docker <a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/">Install Docker on Ubuntu</a></p>

    <h3>Prepare la máquina virtual</h3>

    <p>Si ha realizado los <a href="packer-1.html">ejercicios de Packer</a> de estos apuntes, puede utilizar la máquina virtual creada en el <a href="packer-1.html#modificacion-vm">ejercicio 4</a>, importándola en VirtualBox como servicio virtualizado.</p>

    <p>Si no ha realizado estos ejercicios, cree manualmente una máquina virtual:</p>
    <ol>
      <li>Descargue la imagen iso de la versión más reciente de <strong>Ubuntu 18.04 LTS Server de 64 bits</strong>.
        <p>Actualmente (enero de 2019), la última versión disponible de Ubuntu LTS Server es Ubuntu 18.04.1 (25/07/18). <a href="http://cdimage.ubuntu.com/releases/18.04/release/">Página de descarga</a></p>
      </li>
      <li>Cree una máquina virtual en VirtualBox e instale Ubuntu 18.04 LTS Server.
        <p>Para los ejercicios de esta página un disco duro virtual de 8 GB es suficiente, pero para poder instalar más aplicaciones se necesitaría un disco mayor, por ejemplo de <strong>16 GB</strong>.</p>
        <p>Compruebe que en la configuración de red de la máquina virtual está conectado a <strong>Adaptador puente</strong>. Si está conectado a otro tipo de adaptador (probablemente NAT), apague la máquina virtual, cambie a Adaptador puente y reinicie la máquina virtual.</p>
      </li>
    </ol>

    <h3>Actualice la distribución</h3>

    <p>Arranque la máquina virtual y ejecute los comandos siguientes en un terminal:</p>

    <ol>
      <li>Actualice la distribución:

        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo apt update
sudo apt upgrade</code>
</pre>
        </div>
      </li>
    </ol>

    <h3>Instale utilidades</h3>

    <p>Instale las utilidades siguientes:</p>

    <ol>
      <li>Instale el editor nano:

        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo apt install nano</code>
</pre>
        </div>
      </li>
    </ol>

    <h3>Añada los repositorios de Docker</h3>

    <p>En la máquina virtual, ejecute los comandos siguientes en un terminal:</p>

    <ol>
      <li>Instale los certificados para trabajar con https:

        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo apt update
sudo apt install apt-transport-https ca-certificates curl gnupg-agent software-properties-common</code>
</pre>
        </div>
      </li>
      <li>Añada la clave GPG oficial de Docker:
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</code>
</pre>
        </div>
      </li>
      <li>Compruebe que tiene la clave correcta:
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo apt-key fingerprint 0EBFCD88</code>
</pre>
        </div>
        <p>El resultado debe ser:</p>
        <div class="terminal">
          <pre>
<code class="language-shell">pub   rsa4096 2017-02-22 [SCEA]
      9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88
uid        [desconocida] Docker Release (CE deb) &lt;docker@docker.com&gt;
sub   rsa4096R 2017-02-22 [S]</code>
</pre>
        </div>
      </li>
      <li>Añada el repositorio correspondiente a su versión de Ubuntu (escriba todo en una sola línea, sin las contrabarras \):
        <div class="terminal">
          <pre class="command-line" data-prompt="$" data-output="2-4">
<code class="language-shell">sudo add-apt-repository \
   "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   $(lsb_release -cs) \
   stable"</code>
</pre>
        </div>
      </li>
      <li>Actualice APT:
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo apt update</code>
</pre>
        </div>
      </li>
      <li>Compruebe que APT se conecta con el repositorio adecuado:
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">apt policy docker-ce</code></pre>
        </div>
        <p>En la pantalla debe mostrarse el repositorio de la versión de Docker disponible para la versión de Ubuntu indicada (en el ejemplo se muestran la versión de Docker 18.09.1 y la versión de Ubuntu bionic, es decir, Ubuntu 18.04):</p>
        <div class="terminal">
          <pre>
<code class="language-shell">docker-ce:
  Instalados: (ninguno)
  Candidato: 5:<span class="codigo-resaltado">18.09.1</span>~3-0~<span class="codigo-resaltado">ubuntu-bionic</span>
  Tabla de versión:
  5:18.09.1~3-0~ubuntu-bionic 500
          500 https://download.docker.com/linux/ubuntu bionic/stable amd64 Packages
...</code>
</pre>
        </div>
      </li>
    </ol>

    <h3>Instale Docker</h3>

    <p>En la máquina virtual, ejecute los comandos siguientes en un terminal:</p>

    <ol>
      <li>Actualice el administrador de paquetes:
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo apt update</code>
</pre>
        </div>
      </li>
      <li>Instale la última versión de Docker
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo apt install docker-ce</code>
</pre>
        </div>
      </li>
      <li>Arranque el servicio docker
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo systemctl start docker</code>
</pre>
        </div>
      </li>
      <li>Compruebe que el servicio está activo:
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">systemctl status docker</code>
</pre>
        </div>
        <p>Se mostrará un mensaje similar a este (pulse Ctrl+C para salir del texto):</p>
        <div class="terminal">
          <pre>
<code class="language-shell">&bull; docker.service - Docker Application Container Engine
   Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)
   Active: <span class="codigo-resaltado">active</span> (running) since ...
...</code>
</pre>
        </div>
      </li>
    </ol>
  </section>

  <section id="ejercicio-2">
    <h2>Docker (1) 2 - Imagen hello-world</h2>

    <p>Dos conceptos fundamentales de Docker son los <strong>contenedores</strong> y las <strong>imágenes</strong>.</p>

    <p>Docker encapsula las aplicaciones en <strong>contenedores</strong>. Un contenedor es el equivalente a una máquina virtual de la virtualización clásica, pero mucho más ligera porque utiliza recursos del sistema operativo del <i>host</i>. Las aplicaciones de cada contenedor "ven" un sistema opertativo, que puede ser diferente en cada contenedor, pero quien realiza el trabajo es el sistema operativo común que hay por debajo.</p>

    <p>Docker crea los contenedores a partir de <strong>imágenes</strong>. Las imágenes son una especie de plantillas que contienen como mínimo todo el software que necesita la aplicación para ponerse en marcha. Las imágenes se pueden crear a partir de otras imágenes más básicas incluyendo software adicional en forma de capas. Todos los contenedores creados a partir de una imagen contienen el mismo software, aunque en el momento de su creación se pueden personalizar algunos detalles.</p>

    <p>En la máquina virtual, ejecute los comandos siguientes en un terminal:</p>

    <ol>
      <li>Compruebe que inicialmente no hay ningún contenedor creado (la opción -a hace que se muestren también los contenedores detenidos, sin ella se muestran sólo los contenedor que estén en marcha):
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo docker ps -a</code>
</pre>
        </div>

        <p>o también</p>
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo docker container ls -a</code>
</pre>
        </div>

        <p>La respuesta, en forma de tabla, será la siguiente. La cabecera de la tabla ocupa dos líneas ya que es una tabla con muchos campos.</p>

        <div class="terminal">
          <pre>
<code class="language-shell">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS
PORTS               NAMES</code>
</pre>
        </div>
      </li>
      <li>Compruebe que inicialmente tampoco disponemos de ninguna imagen:
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo docker image ls</code>
</pre>
        </div>
        <p>La respuesta, en forma de tabla, será la siguiente:</p>

        <div class="terminal">
          <pre>
<code class="language-shell">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</code>
</pre>
        </div>
      </li>

      <li>Docker crea los contenedores a partir de imágenes locales (ya descargadas), pero si al crear el contenedor no se dispone de la imagen local, Docker descarga la imagen de su repositorio.

        <p>La orden más simple para crear un contenedor es:</p>
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo docker run IMAGEN</code>
</pre>
        </div>

        <p>Cree un contenedor con la aplicación de ejemplo <strong>hello-world</strong>. La imagen de este contenedor se llama <strong>hello-world</strong>:</p>
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo docker run hello-world</code>
</pre>
        </div>

        <p>Como no tenemos todavía la imagen en nuestro ordenador, Docker descarga la imagen, crea el contenedor y lo pone en marcha. En este caso, la aplicación que contiene el contenedor hello-world simplemente escribe un mensaje de salida al arrancar e inmediatamente se detiene el contenedor. La respuesta será similar a esta:</p>

        <div class="terminal">
          <pre>
<code class="language-shell">Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
1b930d010525: Pull complete
Digest: sha256:2557c3c07ed1e38f26e389462d03ed943586f744521577a99efb77324b0fe535
Status: Download newer image from hello-wolrd:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.
...</code>
</pre>
        </div>
      </li>
      <li>Si listamos ahora los contenedores existentes ...
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo docker ps -a</code>
</pre>
        </div>
        <p>... se mostrará información del contenedor creado:</p>

        <div class="terminal">
          <pre>
<code class="language-shell">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS
PORTS               NAMES
614B4c431ffa        hello-world         "/hello"            2 minutes ago       Exited (0) 2 minutes
ago                 hopeful_elbakyan</code>
</pre>
        </div>
      </li>
      <li>Si listamos ahora las imágenes existentes ...

        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo docker image ls</code>
</pre>
        </div>
        <p>... se mostrará información de la imagen creada:</p>

        <div class="terminal">
          <pre>
<code class="language-shell">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
hello-world         latest              fce209e99eb9        4 weeks ago         1.84 kB</code>
</pre>
        </div>
        <p>Cada contenedor debe tener un identificador (ID) y un nombre distinto. Docker "bautiza" los contenedores con un nombre peculiar, compuesto de un adjetivo y un apellido.</p>
      </li>
      <li>Podemos crear tantos contenedores como queramos a partir de una imagen. Una vez la imagen está disponible localmente, Docker no necesita descargarla y el proceso de creación del contenedor es inmediato (aunque en el caso de hello-world la descarga es rápida, con imágenes más grandes la descarga inicial puede tardar un rato)

        <p>Normalmente se aconseja usar siempre la opción <strong>-d</strong>, que arranca el contenedor en segundo plano (<i>detached</i>) y permite seguir teniendo acceso a la shell (aunque con hello-world no es estrictamente necesario porque el contenedor hello-world se detiene automáticamente tras mostrar el mensaje).</p>

        <p>Al crear el contenedor hello-world con la opción -d no se muestra el mensaje, simplemente muestra el identificador completo del contenedor.</p>

        <div class="terminal">
          <pre class="command-line" data-prompt="$" data-output="2">
<code class="language-shell">sudo docker run -d hello-world
1ae54736196021523a2b21c123fd671253e62150daccd882374</code>
</pre>
        </div>
      </li>
      <li>Si listamos los contenedores existentes ...

        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo docker ps -a</code>
</pre>
        </div>
        <p>... se mostrarán los dos contenedores:</p>

        <div class="terminal">
          <pre>
<code class="language-shell">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS
PORTS               NAMES
1ae547361960        hello-world         "/hello"            4 seconds ago       Exited (0) 3 seconds
ago                 distracted_banach
614B4c431ffa        hello-world         "/hello"            5 minutes ago       Exited (0) 5 minutes
ago                 hopeful_elbakyan</code>
</pre>
        </div>
      </li>
      <li>Los contenedores se pueden destruir mediante el comando <i>rm</i>, haciendo referencia a ellos mediante su nombre o su id. Borre los dos contenedores existentes:
        <div class="terminal">
          <pre class="command-line" data-prompt="$" data-output="2, 4">
<code class="language-shell">sudo docker rm 1ae547361960
1ae547361960
sudo docker rm hopefukl_elbakyan
hopefukl_elbakyan</code>
</pre>
        </div>
        <p>Compruebe que ya no quedan contenedores:</p>

        <div class="terminal">
          <pre class="command-line" data-prompt="$" data-output="2-3">
<code class="language-shell">sudo docker ps -a
CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS
PORTS               NAMES</code>
</pre>
        </div>
      </li>
      <li>Podemos dar nombre a los contenedores al crearlos:
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo docker run -d --name=hola-1 hello-world</code>
</pre>
        </div>

        <p>Al haber utilizado la opción -d únicamente se mostrará el ID completo del contenedor:</p>

        <div class="terminal">
          <pre>
<code class="language-shell">54e9827bd10ab2825e1b3e4d3bf7a8cbdf778b472359c655d72d9c09e753500a</code>
</pre>
        </div>
      </li>
      <li>Si listamos los contenedores existentes ...

        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo docker ps -a</code>
</pre>
        </div>
        <p>... se mostrará el contenedor con el nombre que hemos indicado:</p>

        <div class="terminal">
          <pre>
<code class="language-shell">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS
PORTS               NAMES
54e9827bd10a        hello-world         "/hello"            4 seconds ago       Exited (0) 3 seconds
ago                 <span class="codigo-resaltado">hola-1</span></code>
</pre>
        </div>
      </li>
      <li>Si intentamos crear un segundo contenedor con un nombre ya utilizado ...
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo docker run -d --name=hola-1 hello-world</code>
</pre>
        </div>

        <p>Docker nos avisará de que no es posible:</p>

        <div class="terminal">
          <pre>
<code class="language-shell">docker: Error response from daemon: Conflict. The container <span class="codigo-resaltado">name "/hola-1" is already in use</span> by con
tainer "54e9827bd10ab2825e1b3e4d3bf7a8cbdf778b472359c655d72d9c09e753500a". You have to remove (or re
name) that container to be able to reuse that name.
See 'docker run --help'.</code>
</pre>
        </div>
      </li>
    </ol>
  </section>

  <section id="ejercicio-3">
    <h2>Docker (1) 3 - Imagen apache</h2>

    <p>En este ejercicio vamos a crear un contenedor que incluya un servidor Apache en funcionamiento a partir de una imagen pública, modificar el contenido del contenedor y finalmente, crear una nueva imagen para crear contenedores personalizados.</p>

    <h3>Crear el contenedor Apache</h3>
    <ol>
      <li>Cree un contenedor que contenga un servidor Apache a partir de la imagen <a href="https://github.com/bitnami/bitnami-docker-apache">bitnami/apache</a>
        <p>la opción -P hace que Docker asigne de forma aleatoria un puerto de la máquina virtual al puerto asignado a Apache en el contenedor. La imagen bitnami/apache asigna a Apache el puerto 8080 del contenedor para conexiones http y el puerto 8443 para conexiones https.</p>
        <div class="terminal">
          <pre class="command-line" data-prompt="$" data-output="2">
<code class="language-shell">sudo docker run -d -P --name=apache-1 bitnami/apache
44c9e89bdfd24fa623774b3e774b0fb0efa107f752af5161b1d6b925330a82f6</code>
</pre>
        </div>
      </li>

      <li>Consulte el puerto del <i>host</i> utilizado por el contenedor ...

        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo docker ps -a</code>
</pre>
        </div>
        <p>... se mostrará el contenedor con el nombre que hemos indicado:</p>

        <div class="terminal">
          <pre>
<code class="language-shell">CONTAINER ID        IMAGE               COMMAND                  CREATED                  STATUS
      PORTS                                             NAMES
44c9e89bdfd2        bitnami/apache      "/app-entrypoint.sh &hellip;"   About a minute ago       Up About a min
ute   0.0.0.:<span class="codigo-resaltado">32769-&gt;8080</span>/tcp, 0.0.0.0:<span class="codigo-resaltado">32774-&gt;8443</span>/tcp   apache-1</code>
</pre>
        </div>
      </li>
      <li>Abra en el navegador la página inicial del contenedor y compruebe que se muestra una página que dice "It works!".
        <p class="captura">
          <img src="../img/docker/1-3-e-1-apache.png" alt="Docker. Apache" width="1024" height="150" />
        </p>
      </li>
    </ol>

    <h3>Modificar la página inicial del contenedor Apache</h3>

    <p>En este apartado vamos a modificar la página web inicial de Apache del contenedor Docker.</p>

    <p>Tenga en cuenta que modificar el contenido de un contenedor tal y como vamos a hacer en este apartado sólo es aconsejable en un entorno de desarrollo, pero no es aconsejable en un entorno de producción porque va en contra de la "filosofía" de Docker. Los contenedores de Docker están pensados como objetos de "usar y tirar", es decir, para ser creados, destruidos y creados de nuevo tantas veces como sea necesario y en la cantidad que sea necesaria. En el apartado siguiente realziaremos la misma tarea de una forma más conveniente, modificando no el contenedor sino la imagen a partir de la cual se crean los contenedores.</p>

    <ol>
      <li>Cree un segundo contenedor que contenga un servidor Apache a partir de la imagen <a href="https://github.com/bitnami/bitnami-docker-apache">bitnami/apache</a>
        <div class="terminal">
          <pre class="command-line" data-prompt="$" data-output="2">
<code class="language-shell">sudo docker run -d -P --name=apache-2 bitnami/apache
c5041d12aabdc6f58219fec176036eb352ecaea7cf81b8f7fa2ad8af801c96a2</code>
</pre>
        </div>
      </li>

      <li>Consulte el puerto del <i>host</i> utilizado por el contenedor ...

        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo docker ps -a</code>
</pre>
        </div>
        <p>... se mostrarán los dos contenedores creados:</p>

        <div class="terminal">
          <pre>
<code class="language-shell">CONTAINER ID        IMAGE               COMMAND                  CREATED                  STATUS
      PORTS                                             NAMES
c5041d12aabd        bitnami/apache      "/app-entrypoint.sh &hellip;"   About a minute ago       Up About a min
ute   0.0.0.:<span class="codigo-resaltado">32771-&gt;8080</span>/tcp, 0.0.0.0:<span class="codigo-resaltado">32772-&gt;8443</span>/tcp   apache-2
44c9e89bdfd2        bitnami/apache      "/app-entrypoint.sh &hellip;"   5 minutes ago            Up 5 min
utes   0.0.0.:32769-&gt;8080/tcp, 0.0.0.0:32770-&gt;8443/tcp   apache-1</code>
</pre>
        </div>
      </li>
      <li>Cree la nueva página index.html ...
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo nano index.html</code>
</pre>
        </div>

        <p>... por ejemplo con el contenido siguiente</p>
        <div class="terminal">
          <pre>
<code class="language-shell">&lt;h1&gt;Hola, mundo!&lt;/h1&gt;</code>
</pre>
        </div>
        <p> ... o mejor, una página válida HTML5 (para poder escribir caracteres no ingleses):</p>
        <div class="terminal">
          <pre>
<code class="language-shell">&lt;!DOCTYPE html&gt;
&lt;html lang="es"&gt;
&lt;head&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;title&gt;Apache en Docker&lt;/title&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;p&gt;¡Hola, mundo!.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code>
</pre>
        </div>
      </li>

      <li>Entre en la <i>shell</i> del contenedor para averiguar la ubicación de la página inicial:
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo docker exec -it apache-2 /bin/bash</code>
</pre>
        </div>
        <p>Se abrirá una <i>shell</i> en el contenedor. Fíjese en que está abierta precisamente en la carpeta <strong>htdocs</strong> del servidor</p>
        <div class="terminal">
          <pre>
<code class="language-shell">I have no name!@c5041d12aabd:<span class="codigo-resaltado">/opt/bitnami/apache/htdocs</span>$</code>
</pre>
        </div>
      </li>

      <li>En ese directorio se encuentra el fichero index.html que queremos modificar:
        <div class="terminal">
          <pre>
<code>cat index.html
<span class="codigo-resaltado">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span></code>
</pre>
        </div>

      </li>
      <li>Salga de la shell del contenedor:
        <div class="terminal">
          <pre class="command-line" data-prompt="I have no name!@c5041d12aabd:/opt/bitnami/apache/htdocs$">
<code class="language-shell">exit</code>
</pre>
        </div>
      </li>

      <li>Copie el fichero index.html en el contenedor:
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo docker cp index.html apache:/opt/bitnami/apache/htdocs/index.html</code>
</pre>
        </div>
      </li>
      <li>Abra en el navegador la página inicial del contenedor y compruebe que se ha modificado.
        <p class="captura">
          <img src="../img/docker/1-3-e-2-apache.png" alt="Docker. Apache" width="1024" height="160" />
        </p>
      </li>
    </ol>

    <h3>Crear una nueva imagen</h3>

    <p><strong>Nota</strong>: Si queremos cambiar la página inicial, la forma correcta de hacerlo en Docker es crear una nueva imagen que incluya la página modificada, de manera que cada vez que se cree el contenedor, la página inicial sea la modificada.</p>

    <p>Las imágenes se crean a partir de Dockerfiles, ficheros que describen los elementos que forman la imagen. Los Dockerfiles pueden ser muy extensos. En este caso, se trata de un Dockerfile mínimo.</p>

    <ol>
      <li>Cree un directorio que contendrá el Dockerfile
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo mkdir mi-apache</code>
</pre>
        </div>
      </li>
      <li>Copie el fichero index.html creado anteriormente
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo mv index.html mi-apache</code>
</pre>
        </div>
      </li>
      <li>Entre en el directorio y cree un fichero Dockerlife
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">cd mi-apache
sudo nano Dockerfile</code>
</pre>
        </div>
        <p>El contenido del Dockerfile puede ser el siguiente:</p>
        <div class="terminal">
          <pre>
<code class="language-shell">FROM bitnami/apache
COPY index.html /opt/bitnami/apache/htdocs/index.html</code>
</pre>
        </div>
      </li>
      <li>Genere la nueva imagen. El último argumento es el nombre del archivo Dockerfile que tiene que utilizar para generar la imagen. Como en este caso se encuentra en el mismo directorio y tiene el nombre predeterminado <strong>Dockerfile</strong>, se puede escribir simplemente punto (.):
        <p>El nombre de la imagen debe seguir el patrón <strong>nombre-de-usuario/nombre-de-imagen</strong>. Si la imagen sólo se va a utilizar localmente, el nombre de usuario y de la imagen pueden ser cualquier palabra.</p>
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo docker build -t barto/mi-apache .</code>
</pre>
        </div>
      </li>
      <li>Cree un contenedor a partir de la nueva imagen:
        <div class="terminal">
          <pre class="command-line" data-prompt="$">
<code class="language-shell">sudo docker run -d -P --name=mi-apache-1 barto/mi-apache</code>
</pre>
        </div>
      </li>
      <li>Abra en el navegador la página inicial del contenedor y compruebe que se ha modificado.
        <p class="captura">
          <img src="../img/docker/1-3-e-3-apache.png" alt="Docker. Apache" width="1024" height="160" />
        </p>
      </li>
    </ol>
  </section>

  <section id="ejercicio-4">
    <h2>Docker (1) 4 - Volúmenes</h2>

    <p class="incompleto"><img src="../varios/iconos/icono-en-construccion.svg" alt="En construcción" width="55" height="48" />Este ejercicio está por escribir.</p>
  </section>

  <footer>
    <p class="ultmod">Última modificación de esta página: 4 de febrero de 2019</p>

    <p class="licencia">
      <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.es_ES"><img src="../varios/iconos/icono-cc-by-sa.svg" alt="Licencia Creative Commons" title="Licencia Creative Commons BY-SA" width="120" height="42" /></a><br />
      Esta página forma parte del curso <strong><a href="http://www.mclibre.org/consultar/webapps/">Aplicaciones web</a></strong> por <a href="http://www.mclibre.org/" rel="author">Bartolomé Sintes Marco</a><br />
      que se distribuye bajo una <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.es_ES">Licencia Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional (CC BY-SA 4.0)</a>.
    </p>
  </footer>
</body>
</html>
