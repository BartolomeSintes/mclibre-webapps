<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Ejercicios (1). Nextcloud. Aplicaciones web. Bartolomé Sintes Marco. www.mclibre.org</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="../varios/webapps.css" title="mclibre" />
  <link rel="icon" href="../varios/favicon.ico" />
</head>

<body>
  <h1>Nextcloud. Ejercicios (1)</h1>

  <nav>
    <p>
      <a href="../index.html"><img src="../varios/iconos/icono-webapps.svg" alt="Índice de WebApps" title="Índice de WebApps" width="48" height="31" /></a>
      <a href="#"><img src="../varios/iconos/icono-arrow-circle-up.svg" alt="Principio de la página" title="Principio de la página" width="36" height="36" /></a>
    </p>

    <div class="toc">
      <h2>
        <a href="nextcloud.html"><img src="../varios/iconos/icono-flecha-izquierda.svg" alt="Anterior" title="Anterior" width="15" height="18" /></a> Nextcloud (1)
        <a href="nextcloud-2.html"><img src="../varios/iconos/icono-flecha-derecha.svg" alt="Siguiente" title="Siguiente" width="15" height="18" /></a>
      </h2>

      <h3>Enunciados</h3>
      <ul>
        <li><a href="#ejercicio-1">1 - Crear contenedores</a></li>
        <li><a href="#ejercicio-2">2 - Completar instalación</a></li>
        <li><a href="#ejercicio-3">3 - Actualizar</a></li>
        <li><a href="#ejercicio-4">4 - Habilitar https</a></li>
        <li><a href="#ejercicio-5">5 - http a https</a></li>
        <li><a href="#ejercicio-6">6 - Cambio IP</a></li>
      </ul>

      <h3><a href="nextcloud-1-soluciones.html">Soluciones</a></h3>
      <ul>
        <li><a href="nextcloud-1-soluciones.html#ejercicio-1">1 - Crear contenedores</a></li>
        <li><a href="nextcloud-1-soluciones.html#ejercicio-2">2 - Completar instalación</a></li>
        <li><a href="nextcloud-1-soluciones.html#ejercicio-3">3 - Actualizar</a></li>
        <li><a href="nextcloud-1-soluciones.html#ejercicio-4">4 - Habilitar https</a></li>
        <li><a href="nextcloud-1-soluciones.html#ejercicio-5">5 - http a https</a></li>
        <li><a href="nextcloud-1-soluciones.html#ejercicio-6">6 - Cambio IP</a></li>
      </ul>
    </div>
  </nav>

  <p>En esta lección se proponen ejercicios para conocer y utilizar <strong>Nextcloud</strong>. Se pueden consultar las <a href="nextcloud-1-soluciones.html">soluciones de estos ejercicios de Nextcloud</a>, aunque se recomienda intentar realizarlos primero sin recurrir a estas soluciones. A continuación se pueden realizar los <a href="nextcloud-2.html">ejercicios (2) de Nextcloud</a>, en los que se amplian las funcionalidades de Nextcloud.</p>

  <hr />

  <p>Nextcloud:</p>
  <ul>
    <li>LibreOfiice en Nextcloud:
      <a href="https://www.collaboraoffice.com/code/">Collabora Online (CODE)</a> -
      <a href="https://nextcloud.com/collaboraonline/">Información en web Nextcloud</a>
    </li>
  </ul>

  <section id="ejercicio-1">
    <h2>Nextcloud (1) 1 - Crear contenedores Docker</h2>

    <p>Actualmente (enero de 2018), Nextcloud no está disponible en Windows ni está disponible como instalador de Bitnami, por lo que lo instalaremos como contenedor Docker.</p>

    <p>La imagen oficial Docker de Nextcloud es <a href="https://github.com/nextcloud/docker">https://github.com/nextcloud/docker</a>, disponible desde enero de 2017 a partir de una imagen creada por Pierre Ozoux.</p>

    <hr class="corta" />

    <p>En este ejercicio se trata de crear el contenedor Docker de Nextcloud en una máquina virtual.</p>

    <ol>
      <li>Prepare una máquina virtual de Ubuntu 16.04 LTS Server con 16 GB de disco virtual e instale Docker.</li>
      <li>Nextcloud puede utilizar su propia base de datos SQLite o utilizar una base de datos MariaDB/MySQL o PostgreSQL. Para instalaciones pequeñas como la de estos ejercicios, SQLite es una opción suficiente, pero en servidores reales se recomienda utilizar un sistema gestor de bases de datos independiente. Para practicar el uso de Docker, puede utilizar MariaDB. Para ello:
        <ol>
          <li>Cree una red e incluya los tres contenedores (MariaDB, phpMyAdmin y NextCloud) en ella.</li>
          <li>Cree un contenedor de MariaDB a partir de la imagen bitnami/mariadb. Utilice la variable de configuracion ALLOW_EMPTY_PASSWORD.</li>
          <li>Cree un contenedor de phpMyAdmin que escuche en un puerto distino del puerto 80, por ejemplo, en el 8081, a partir de la imagen bitnami/phpmyadmin. Utilice la variable de configuracion DATABASE_HOST para indicar el nombre del contenedor de MariaDB.</li>
          <li>Cree en MariaDB con phpMyAdmin un usuario <span class="codigo-modificacion">nextcloud</span>, que pueda acceder desde cualquier ordenador, con contraseña <span class="codigo-modificacion">nextcloud</span> y base de datos única.</li>
          <li>Cree un contenedor de Nextcloud a partir de la imagen nextcloud, que escuche en los puertos 80 y 443.</li>
          <li>Compruebe en el navegador del ordenador anfitrión que puede ver la página de entrada en NextCloud, escribiendo la dirección <strong>http://AAA.BBB.CCC.DDD/</strong>, en la que AAA.BBB.CCC.DDD es la dirección IP de la máquina virtual.
            <p class="captura">
              <img src="../img/nextcloud/1-1-e-1-instalaciones.png" alt="Nextcloud. Instalación" width="400" height="280" />
            </p>
          </li>
        </ol>
      </li>
    </ol>
  </section>

  <section id="ejercicio-2">
    <h2>NextCloud (1) 2 - Completar instalación</h2>

    <p>En este ejercicio se trata de completar la instalación de Nextcloud.</p>

    <ol>
      <li>Consulte cuál es la dirección IP privada 172.BBB.CCC.DDD del contenedor de MariaDB.
        <div class="codigo">
          <pre><code class="language-shell">sudo docker network inspect RED</code></pre>
        </div>
      </li>
      <li>Complete la instalación de NextCloud:
        <ul>
          <li>Nombre de usuario: <span class="codigo-modificacion">admin</span></li>
          <li>Contraseña: <span class="codigo-modificacion">admin</span></li>
          <li>Almacenamiento: directorio predeterminado</li>
          <li>Base de datos: <span class="codigo-modificacion">MySQL / MariaDB</span></li>
        </ul>
        <p><strong>Notas</strong>: La contraseña sugerida se considera muy débil y no debería utilizarse en un entorno real.</p>
      </li>
      <li>Se mostrará el interfaz de Nextcloud con un aviso de bienvenida
        <p class="captura">
          <img src="../img/nextcloud/1-2-e-1-instalaciones.png" alt="Nextcloud. Bienvenida" width="504" height="340" />
        </p>
      </li>
      <li>Salga de Nextcloud y compruebe que puede volver a entrar como administrador.
        <p class="captura">
          <img src="../img/nextcloud/1-2-e-2-instalaciones.png" alt="Nextcloud. Entrar" width="400" height="350" />
        </p>
      </li>
      <li>Si ha instalado Nextcloud de manera que utilice MariaDB como base de datos, compruebe con phpMyAdmin que se han creado las tablas correspondientes. Si no se hubiera creado ninguna tabla es que Nextcloud está utilizando SQLite.
        <p class="captura">
          <img src="../img/nextcloud/1-2-e-3-instalaciones.png" alt="Nextcloud. Entrar" width="800" height="320" />
        </p>
      </li>
    </ol>
  </section>

  <section id="ejercicio-3">
    <h2>Nextcloud (1) 3 - Actualizar Nextcloud</h2>

    <p>En este ejercicio se trata de actualizar Nextcloud, en caso de que haya una actualización disponible:</p>

    <p><strong>Nota</strong>: Actualmente (febrero de 2018), todavía no se ha publicado ninguna actualización de NExtCloud 13. La versión 13.0.1 está prevista para mediados de marzo de 2018.</p>
  </section>

  <section id="ejercicio-4">
    <h2>Nextcloud (1) 4 - Habilitar https en el servidor</h2>

    <p>Referencia: <a href="https://docs.nextcloud.com/server/13/admin_manual/configuration_server/harden_server.html">https://docs.nextcloud.com/server/13/admin_manual/configuration_server/harden_server.html</a></p>

    <ol>
      <li>Compruebe que al acceder a NextCloud mediante una conexión <strong>no</strong> cifrada <strong>http://AAA.BBB.CCC.DDD/</strong>, se muestra el aviso siguiente:
        <p class="captura">
          <img src="../img/nextcloud/1-4-e-1-https.png" alt="Nextcloud. Entrar" width="400" height="350" />
        </p>
      </li>
      <li>Intente entrar en Nextcloud como administrador mediante una conexión cifrada <strong>https://AAA.BBB.CCC.DDD/</strong> y compruebe que se muestra el aviso siguiente:
        <p class="captura">
          <img src="../img/nextcloud/1-4-e-2-https.png" alt="Nextcloud. Conexión no segura" width="1008" height="360" />
        </p>
      </li>
      <li>Configure el servidor Apache del contenedor para permitir conexiones seguras.
        <p>Para ello, entre en el contenedor, genere un autocertificado, active el módulo SSL en Apache, habilite la configuración SSL en Apache y reinicie Apache.</p>
      </li>
      <li>Intente entrar en Nextcloud como administrador mediante una conexión cifrada <strong>https://AAA.BBB.CCC.DDD/</strong> y compruebe que se muestra el aviso siguiente:
        <p class="captura">
          <img src="../img/nextcloud/1-4-e-3-https.png" alt="Nextcloud. Conexión no segura" width="1008" height="260" />
        </p>
      </li>
      <li>Añada al navegador la excepción para mostrar la página y compruebe que ya no se muestra el aviso de conexión no segura:
        <p class="captura">
          <img src="../img/nextcloud/1-4-e-4-https.png" alt="Nextcloud. Entrar" width="400" height="350" />
        </p>
      </li>
    </ol>
  </section>

  <section id="ejercicio-5">
    <h2>Nextcloud (1) 5 - Acceder siempre mediante https</h2>

    <p>Referencia: <a href="https://docs.nextcloud.com/server/13/admin_manual/configuration_server/harden_server.html">https://docs.nextcloud.com/server/13/admin_manual/configuration_server/harden_server.html</a></p>

    <ol>
      <li>Configure el servidor Apache del contenedor para forzar el acceso mediante https.
        <p>Para ello, modifique el archivo de configuración de Apache <strong>apache2.conf</strong> que se encuentra en el contenedor y reinicie el servicio apache2.</p>
        <p class="incompleto"><img src="../varios/iconos/icono-warning.svg" alt="¡Atención!" width="55" height="48" />Antes de modificar un archivo de configuración se recomienda siempre hacer una copia del archivo original.</p>
        <ul>
          <li>En el archivo de congiguración, añada una directiva VirtualHost que redirija las peticiones http a https, en la que AAA.BBB.CCC.DDD es la IP de la máquina virtual:
            <div class="codigo">
              <pre>
<code class="language-configuracion">&lt;VirtualHost *:80&gt;
  Servername <span class="codigo-modificacion">AAA.BBB.CCC.DDD</span>
  Redirect permanent / https://<span class="codigo-modificacion">AAA.BBB.CCC.DDD</span>/
&lt;/VirtualHost&gt;</code>
</pre>
            </div>
            <p><strong>Nota</strong>: Creo que el valor de Servername no es importante, pero debe haber Servername.</p>
          </li>
        </ul>
      </li>
      <li>Compruebe que al escribir <strong>http://AAA.BBB.CCC.DDD/</strong> se redirige automáticamente a <strong>https://AAA.BBB.CCC.DDD/</strong></li>
    </ol>
  </section>

  <section id="ejercicio-6">
    <h2>Nextcloud (1) 6 - Cambio de IP</h2>

    <p>Si cambiara la IP de la máquina virtual, la redirección de http a https realizada en el ejercicio anterior dejaría de funcionar correctamente porque en el archivo de configuración se guarda la URL de la máquina virtual. En clase esto ocurre a menudo, ya que el router de aula está continuamente asignando direcciones. En casa puede ocurrir más raramente. En este ejercicio se trata de provocar esta situación y corregirla.</p>

    <ol>
      <li>Apague y reinicie la máquina virtual.</li>
      <li>Compruebe si la IP de la máquina virtual ha cambiado. Si <strong>no</strong> ha cambiado automáticamente, cámbiela manualmente, reinicie la máquina virtual y compruebe que la IP ha cambiado.</li>
      <li>Compruebe que Nextcloud no se redirige de http a https.</li>
      <li>Corrija el archivo de configuración <strong>apache2.php</strong> con la nueva IP.</li>
      <li>Compruebe que NextCloud redirige de http a https.</li>
    </ol>
  </section>

  <footer>
    <p class="ultmod">Última modificación de esta página: 12 de febrero de 2018</p>

    <p class="licencia">
      <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.es_ES"><img src="../varios/iconos/icono-cc-by-sa.svg" alt="Licencia Creative Commons" title="Licencia Creative Commons BY-SA" width="120" height="42" /></a><br />
      Esta página forma parte del curso <strong><a href="http://www.mclibre.org/consultar/webapps/">Aplicaciones web</a></strong> por <a href="http://www.mclibre.org/" rel="author">Bartolomé Sintes Marco</a><br />
      que se distribuye bajo una <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.es_ES">Licencia Creative Commons Reconocimiento-CompartirIgual 4.0 Internacional (CC BY-SA 4.0)</a>.
    </p>
  </footer>
</body>
</html>
